[{"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\index.js":"1","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\reportWebVitals.js":"2","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\authentication\\OTP.js":"3","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\charts\\Graphs.js":"4","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\staff\\StaffChat.js":"5","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\chat\\reviews.js":"6","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\staff\\ViewApplication.js":"7","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\context\\ThemeContext.js":"8","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\navigation\\Navbar.js":"9","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\authentication\\Login.js":"10","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\authentication\\SignUp.js":"11","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\home\\Home.js":"12","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\profile\\UserProfile.js":"13"},{"size":816,"mtime":1620366572155,"results":"14","hashOfConfig":"15"},{"size":375,"mtime":1619934055275,"results":"16","hashOfConfig":"15"},{"size":5751,"mtime":1620554355511,"results":"17","hashOfConfig":"15"},{"size":11112,"mtime":1620642227918,"results":"18","hashOfConfig":"15"},{"size":11769,"mtime":1621322365957,"results":"19","hashOfConfig":"15"},{"size":2382,"mtime":1621080105141,"results":"20","hashOfConfig":"15"},{"size":6353,"mtime":1622653982921,"results":"21","hashOfConfig":"15"},{"size":465,"mtime":1619934055269,"results":"22","hashOfConfig":"15"},{"size":13693,"mtime":1622439883376,"results":"23","hashOfConfig":"15"},{"size":7302,"mtime":1620975585036,"results":"24","hashOfConfig":"15"},{"size":14517,"mtime":1620554344857,"results":"25","hashOfConfig":"15"},{"size":1499,"mtime":1621068707003,"results":"26","hashOfConfig":"15"},{"size":13603,"mtime":1622578709524,"results":"27","hashOfConfig":"15"},{"filePath":"28","messages":"29","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},"1fgf3se",{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"37","messages":"38","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"39","usedDeprecatedRules":"30"},{"filePath":"40","messages":"41","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"42","messages":"43","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"44","messages":"45","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"46","messages":"47","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"48","messages":"49","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"50","messages":"51","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"52","messages":"53","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"54","messages":"55","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\index.js",[],["56","57"],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\reportWebVitals.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\authentication\\OTP.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\charts\\Graphs.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\staff\\StaffChat.js",["58"],"import React from \"react\";\r\nimport { Box,Chip,Grid, IconButton, Paper, TextField, Typography,makeStyles, Container, Dialog, DialogTitle, DialogContent,DialogContentText,DialogActions} from \"@material-ui/core\";\r\nimport { Redirect } from \"react-router\";\r\nimport jwtDecode from 'jwt-decode'\r\nimport axios from \"axios\";\r\nimport {getToken} from \"../authentication/cookies\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { SendRounded } from \"@material-ui/icons\";\r\nimport { useSnackbar } from \"notistack\";\r\nimport clsx from \"clsx\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    messageLeft : {\r\n        display:'flex',\r\n        justifyContent:'flex-start'\r\n    },\r\n    messageRight : {\r\n        display:'flex',\r\n        justifyContent:'flex-end'\r\n    },\r\n    message : {\r\n        padding:5,\r\n        margin : 5,\r\n        justifyContent : 'flex-end',\r\n        backgroundColor : theme.palette.primary,\r\n        width:'fit-content'\r\n    }\r\n}));\r\n\r\nconst StaffChat = () => {\r\n    let token = getToken();\r\n    const is_staff = token ==='' ? 'true' : jwtDecode(token).is_staff;\r\n    const [text, setText] = React.useState('');\r\n    const [messages, setMessages] = React.useState([]);\r\n    const [chats,setChats] = React.useState([]);\r\n    const [socket,setSocket] = React.useState(null);\r\n    const [open,setOpen] = React.useState(false);\r\n    const classes = useStyles();\r\n    const [currentChatUser,setcurrentChatUser] = React.useState({email : '',name : '',slug : ''});\r\n    const {enqueueSnackbar, closeSnackbar} = useSnackbar();\r\n    const showAlert = (key,message,variant)=>enqueueSnackbar(message, {variant: variant, key: key});\r\n    const closeAlert = (key,time)=>setTimeout(() => closeSnackbar(key),time);\r\n\r\n    React.useEffect(() => {\r\n        showAlert('chats','Getting your chats...','info');\r\n        axios.get(`${process.env.REACT_APP_API_URL}/portal/hospitals/${jwtDecode(token).hospital_slug}/`,{\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    Authorization: `Token ${token}` // fetch all chats of hospital\r\n                }\r\n            }).then(res=>{\r\n                closeAlert('chats',2000);\r\n                setChats(res.data.chats);\r\n                setcurrentChatUser({\r\n                    ...currentChatUser,\r\n                    email : res.data.chats[0].user_email,\r\n                    name : res.data.chats[0].name,\r\n                    slug : res.data.chats[0].chat_slug\r\n                })\r\n                connecttoSocket(res.data.chats[0].chat_slug);\r\n            }).catch((error)=>{\r\n                closeAlert('chats',2000);\r\n                showAlert('chats_error',error.message,'error');\r\n                closeAlert('chats_error',2000);\r\n            })\r\n\r\n            return ()=>{\r\n                if(socket){\r\n                    socket.close();\r\n                }\r\n            }\r\n    }, []);\r\n\r\n    \r\n    if(token === '' || is_staff===false) {\r\n        return <Redirect to='/'/>\r\n    }\r\n\r\n    const connecttoSocket = (slug)=>{\r\n        var element = document.getElementById(\"chat\");\r\n        let socket = new WebSocket(`${process.env.REACT_APP_SOCKET_URL}/ws/chat/${slug}/`);\r\n        socket.onopen = function(e) {\r\n            socket.send(JSON.stringify({\r\n                'command': 'fetch_messages',\r\n                'email': jwtDecode(token).email,\r\n                'chatSlug': slug\r\n            }))\r\n            setMessages(JSON.parse(e.data).messages)\r\n            element.scrollTop = element.scrollHeight;\r\n        };\r\n\r\n        socket.onmessage = (e)=>{\r\n            setMessages(JSON.parse(e.data).messages)\r\n            element.scrollTop = element.scrollHeight;\r\n        }\r\n\r\n        socket.onclose = function(event) {\r\n            if (event.wasClean) {\r\n                showAlert('socket_close',`Connection closed cleanly, code=${event.code} reason=${event.reason}`,'error');\r\n            } else {\r\n                showAlert('socket_close','Connection died','error');\r\n            }\r\n            closeAlert('socket_close',2000);\r\n        };\r\n\r\n        socket.onerror = function(error) {\r\n            showAlert('socket_error',error,'error');\r\n            closeAlert('socket_error',2000);\r\n        }; \r\n        setSocket(socket);\r\n    }\r\n\r\n\r\n    const sendMessage = () => {\r\n        socket.send(JSON.stringify({\r\n            'message': text,\r\n            'from': (jwtDecode(getToken())).email,\r\n            'command': 'new_message',\r\n            'chatSlug': currentChatUser.slug //old state\r\n        }));\r\n        \r\n        let user_chats = [...chats];\r\n        user_chats.forEach(chat=>{\r\n            if(chat.user_email === currentChatUser.email){\r\n                chat.last_message = text;\r\n            }\r\n        })\r\n        setChats(user_chats);\r\n        setText('');\r\n    }\r\n\r\n    const broadcastMessage = () => {\r\n        socket.send(JSON.stringify({\r\n            'message': text,\r\n            'from': jwtDecode(getToken()).email,\r\n            'command': 'broadcast_message',\r\n        }));\r\n        let user_chats = [...chats];\r\n        user_chats.forEach(chat=>{\r\n           \r\n                chat.last_message = text;\r\n        })\r\n        setChats(user_chats);\r\n        setText('');\r\n    }\r\n\r\n    const handleChange = (email,name,slug)=>{\r\n        if(email!==currentChatUser.email){\r\n            setcurrentChatUser({\r\n                ...currentChatUser,\r\n                email : email,\r\n                name : name,\r\n                slug : slug\r\n            })\r\n            //connect to socket\r\n            if(socket){\r\n                socket.close();\r\n            }    \r\n            connecttoSocket(slug); \r\n        }\r\n    }\r\n\r\n    const renderMessages = ()=>(\r\n        <React.Fragment>\r\n            {messages.map(message=>(\r\n                <Box key={message.id} color=\"primary.main\" className={clsx({\r\n                    [classes.messageLeft] : (message.user !== jwtDecode(token).email), //always applies\r\n                    [classes.messageRight] : (message.user === jwtDecode(token).email) //only when open === true\r\n                })}>\r\n                    <Paper variant='outlined' className={classes.message}>\r\n                        <Typography variant='h6'>{message.message}</Typography>\r\n                        <Typography variant='caption' color='textSecondary'>{renderTimestamp(message.timestamp)}</Typography>\r\n                    </Paper>\r\n                </Box>\r\n            ))}\r\n        </React.Fragment>\r\n    )\r\n    const renderTimestamp = timestamp => {\r\n        let prefix = \"\";\r\n        const timeDiff = Math.round(\r\n            (new Date().getTime() - new Date(timestamp).getTime()) / 60000\r\n        );\r\n        if (timeDiff < 1) {\r\n            // less than one minute ago\r\n            prefix = \"just now...\";\r\n        } else if (timeDiff < 60 && timeDiff > 1) {\r\n            // less than sixty minutes ago\r\n            prefix = `${timeDiff} minutes ago`;\r\n        } else if (timeDiff < 24 * 60 && timeDiff > 60) {\r\n            // less than 24 hours ago\r\n            prefix = `${Math.round(timeDiff / 60)} hours ago`;\r\n        } else if (timeDiff < 31 * 24 * 60 && timeDiff > 24 * 60) {\r\n            // less than 7 days ago\r\n            prefix = `${Math.round(timeDiff / (60 * 24))} days ago`;\r\n        } else {\r\n            prefix = `${new Date(timestamp).toDateString()}`;\r\n        }\r\n        return prefix;\r\n    };\r\n\r\n    const broadcastDialog = ()=>(\r\n        <Dialog open = {open}>\r\n            <DialogTitle>Broadcast a message</DialogTitle>\r\n            <DialogContent>\r\n                <DialogContentText>\r\n                    You can broadcast a message to all the applicants of your hospital.\r\n                </DialogContentText>\r\n                <TextField\r\n                    variant=\"outlined\"\r\n                    label=\"Type your message here...\"\r\n                    margin=\"normal\"\r\n                    onChange={event => setText(event.target.value)}\r\n                    fullWidth\r\n                    required/>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={()=> setOpen(false)} color=\"secondary\">\r\n                    Cancel\r\n                </Button>\r\n                <Button onClick={broadcastMessage} color=\"primary\">\r\n                    Send\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    )\r\n    const renderChats = ()=>(\r\n        <React.Fragment>\r\n            {chats.map(chat=>( \r\n                <Paper elevation={2} key={chat.chat_slug} \r\n                        style={{marginTop:10,padding:10,display:\"flex\",justifyContent:'space-between'}}\r\n                        onClick={handleChange.bind(this,chat.user_email,chat.name,chat.chat_slug)}\r\n                        >\r\n                    <div>\r\n                        <Typography variant='h6'>{chat.name}</Typography>\r\n                        <Typography variant='caption' color=\"textSecondary\">{chat.last_message}</Typography>\r\n                    </div>\r\n                    <Chip size='small' label={'Active'} color='primary'/>\r\n                </Paper>\r\n                    )\r\n                )\r\n            }\r\n        </React.Fragment>\r\n    )\r\n\r\n    return (\r\n        <Container>\r\n            <Grid container spacing={3}>\r\n                <Grid item xs={6}>\r\n                        <Paper elevation={2} style={{padding:10,display:\"flex\",justifyContent:'space-between'}}>\r\n                            <Typography variant='h4'>Chats</Typography>\r\n                            <Button variant='contained' color='primary' size=\"small\" \r\n                                onClick={()=>setOpen(true)}>Broadcast Message</Button>\r\n                        </Paper>   \r\n                        {renderChats()}\r\n                </Grid>\r\n                <Grid item xs={12} sm={6}>\r\n                        <Box>\r\n                            <Paper elevation={3} style={{padding:10}}>\r\n                                <Typography variant='h5'>{currentChatUser.name}</Typography>\r\n                                <Typography variant='h6' color=\"textSecondary\" >{currentChatUser.email}</Typography>\r\n                            </Paper>\r\n                            <Paper elevation={3} id='chat' style={{\r\n                                marginTop:10,\r\n                                height:500,\r\n                                padding:10,\r\n                                overflow:'auto'\r\n                                }}>\r\n                                {renderMessages()}\r\n                            </Paper>\r\n                            <Paper elevation={3} style={{\r\n                                padding :10,\r\n                                alignItems:'center',\r\n                                bottom:0,\r\n                                overflow:'hidden',\r\n                                display:'flex',\r\n                                justifyContent:'space-between',\r\n                                marginTop:10\r\n                            }}>\r\n                                <TextField\r\n                                    placeholder=\"Type a message\"\r\n                                    variant='outlined'\r\n                                    onChange={(event => setText(event.target.value))}\r\n                                    value={text}\r\n                                    fullWidth\r\n                                />\r\n                                <IconButton  onClick={sendMessage}>\r\n                                    <SendRounded fontSize='large'/>\r\n                                </IconButton>\r\n                            </Paper>           \r\n                        </Box>           \r\n                </Grid>\r\n                {broadcastDialog()}\r\n            </Grid>\r\n       </Container>\r\n    )\r\n}\r\n\r\nexport default StaffChat;","C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\chat\\reviews.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\staff\\ViewApplication.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\context\\ThemeContext.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\navigation\\Navbar.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\authentication\\Login.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\authentication\\SignUp.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\home\\Home.js",[],"C:\\Users\\admin\\Desktop\\COVID-19_Bed-Allotment-System\\frontend\\src\\components\\profile\\UserProfile.js",[],{"ruleId":"59","replacedBy":"60"},{"ruleId":"61","replacedBy":"62"},{"ruleId":"63","severity":1,"message":"64","line":72,"column":8,"nodeType":"65","endLine":72,"endColumn":10,"suggestions":"66"},"no-native-reassign",["67"],"no-negated-in-lhs",["68"],"react-hooks/exhaustive-deps","React Hook React.useEffect has missing dependencies: 'closeAlert', 'connecttoSocket', 'currentChatUser', 'showAlert', 'socket', and 'token'. Either include them or remove the dependency array. You can also do a functional update 'setcurrentChatUser(c => ...)' if you only need 'currentChatUser' in the 'setcurrentChatUser' call.","ArrayExpression",["69"],"no-global-assign","no-unsafe-negation",{"desc":"70","fix":"71"},"Update the dependencies array to be: [closeAlert, connecttoSocket, currentChatUser, showAlert, socket, token]",{"range":"72","text":"73"},[2890,2892],"[closeAlert, connecttoSocket, currentChatUser, showAlert, socket, token]"]